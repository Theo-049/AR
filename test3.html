<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Carte de visite AR</title>

    <!-- A-Frame -->
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>

    <!-- AR.js (CDN valide) -->
    <script src="https://unpkg.com/ar.js@2.1.7/aframe/build/aframe-ar.js"></script>
</head>

<body style="margin: 0; overflow: hidden;">

<a-scene embedded arjs="sourceType: webcam; debugUIEnabled: false;">
    
    <a-assets>
        <img id="cardImage" src="capture.jpg">
    </a-assets>

    <!-- Marker -->
    <a-marker
        id="marker"
        type="pattern"
        url="/AR/pattern-hiro.patt"
        emitevents="true"
    >
        <!-- Carte de visite en AR -->
        <a-plane
            id="imagePlane"
            position="0 0 0"
            rotation="-90 0 0"
            width="4"
            height="2.25"
            material="shader: flat; src: #cardImage;"
            scale="1 1 1">
        </a-plane>
    </a-marker>

    <a-entity camera></a-entity>
</a-scene>

<script>
(() => {
    const plane = document.getElementById("imagePlane");
    const marker = document.getElementById("marker");

    let isAnimating = false;
    const animationDuration = 1000;

    marker.addEventListener("markerFound", () => {
        if (!isAnimating) {
            animatePlane(0, 1.5);
        }
    });

    marker.addEventListener("markerLost", () => {
        if (!isAnimating) {
            animatePlane(1.5, 0);
        }
    });

    function animatePlane(startX, endX) {
        isAnimating = true;
        const startTime = performance.now();

        function update(time) {
            const progress = Math.min((time - startTime) / animationDuration, 1);
            const x = startX + (endX - startX) * progress;

            plane.setAttribute("position", `${x} 0 0`);

            if (progress < 1) {
                requestAnimationFrame(update);
            } else {
                isAnimating = false;
            }
        }

        requestAnimationFrame(update);
    }
})();
</script>

</body>
</html>
